from __future__ import print_function, unicode_literals
import json
import requests
from pprint import pprint
import re
import sys
import semantria
import uuid
import time
import pickle
import dill

tst2 = "As you know, during 2008 the worlds financial markets, our industry and we at AXIS have all experienced an unprecedented confluence of events. All of these events were adverse with respect to financial results for the year. Our long held views regarding correlation of risk were torn apart and the global financial markets were faced with a stark reality in this brave new world that at the extreme everything is correlated.Even in the face of this unprecedented confluence of events our industry has demonstrated remarkable resilience and I expect well continue to perform well relative to other sectors within the broader financial services industry.While this is true for the industry there are still points of differentiation. AXIS has once again differentiated itself as having a very well managed and well understood portfolio of underwriting risks. Our estimates of net losses from hurricanes Gustav and Ike remain unchanged relative to our estimates at the end of the third quarter. This is the direct result of deliberate risk management decisions and actions taken well in advance of the onset of the hurricane season.Our diversified business model is equipped to absorb losses in stress conditions. The current global credit crisis and deteriorating economic environment represents a stress scenario for some areas of our underwriting portfolio. David has already discussed our investment portfolio as well as liquidity and capital resources.Before I move on to my forward looking comments, I would like to briefly discuss elements of our underwriting portfolio affected by the credit crisis and the deteriorating economic environment. We have continuously and thoroughly reviewed our professional lines credit and bond reinsurance and credit and political risk insurance lines in light of these events and believe that our exposure to the credit crisis in all of these lines has been prudently addressed in our financial results.As we have pointed out in previous earning call discussions we began addressing the credit crisis through our reserving in early 2007. Our overall professional liability business in our insurance segment which is diversified well beyond financial institutions business is reserved to an estimated combined ratio of 113% for accident year 2007 and 103% for accident year 2008. Our professional lines reinsurance business also diversified well beyond financial institutions is reserved to an estimated combined ratio of 108% for accident years 2007 and 2008.These are prudent combined ratios not only in the light of a notification and claims we have received as well as accounts identified with potential exposure but also in light of the high attachment points and relatively low net limits typically for our portfolio areas of exposure.For our exposed D&O insurance coverages our average net limit is approximately $6 million and our average attachment point is $117 million. For our exposed side coverages our average net limit is approximately $7 million and our average attachment point is $164 million. Similarly we have reviewed exposure in our reinsurance segment and believe that we are prudently reserved given that our average individual reinsured exposures or our share of a full limit reinsured loss for one client are under $1 million.I also want to provide some preliminary information with respect to the highly publicized Madoff Ponzi Scheme. Based on information receive to date in our insurance segment which includes 11 precautionary notifications, our assessment is that any claims that do flow to AXIS from this event will be limited in number and contained within our loss base. Personally, we do not insure any Madoff entities.D&O risk would appear to be limited unless there are third party insolvencies resulting from this issue. The majority of claims from the event are likely to fall under year low policies and are likely to come from investors who relied on the due diligence and recommendations of advisors including commercial banks, asset managers, private banks, and fund to funds.These E&O limits are generally smaller than D&O limits and these E&O matters will be very complex and difficult to unravel with respect to the duties of the various advisors duties. We expect crime risk to be limited unless employees of our insureds are found to have benefited for example illegally in the form of kick backs instead of management fees.Finally, we have generally avoided fund to fund and private banking business in Europe which have been impacted rather more significantly. Our preliminary review of our professional lines reinsurance exposure also reveals that exposure to Madoff is likely to be contained within our loss base.Moving on from professional line to credit exposures in our underwriting portfolio I will start with a discussion of our trade credit and bond business in Europe. We have been taking prudent reserving actions with respect to this business since early 2008 in recognition of an increase in insolvencies. Our estimated combined ratio for this reinsurance line now stands at the prudent 107% for 2007 and 113% for 2008.I have heard some of the commentary around this line of business and do want to highlight that there are points of differentiation amongst reinsurance portfolios particularly in terms of breadth of product, spectrum, and geography. First on the product front, we dont specifically reinsure products closer to the financial markets like political risk and bank trade finance. We underwrite some of these risks on a risk by risk basis in our insurance segment so our trade credit reinsurance book is focused on covering trade credit insurers who can turn over their risk portfolios in around 60 days on average.Second, our credit reinsurance portfolio is dominated by reinsurance of the three largest trade credit insurers who have diversified exposures predominantly in western economies and are underweight in Spain. Because of this diversification and our view of the outlook for the Spanish credit and bond insurance marketplace we had only a small share of the heavy loss activity in Spain that occurred in 2007 and 2008.Finally, I want to spend some time on our political risk and credit exposures in AXIS insurance. I am aware that questions have been asked about the specific products that we offer here. I am going to share brief overview of these lines and discuss activity in 2008 which should give you a flavor for the risk here and at the same time highlight the principals over our underwriting.In our insurance segment we provide traditional political risk insurance coverages, sovereign default insurance coverage and credit insurance. Sovereign default insurance is a relatively straightforward concept and the traditional political risk coverages basically provide protection against sovereign actions resulting in impairment of cross border investments for banks and corporations known as CEND coverages.Our credit coverage is primarily for lenders seeking to mitigate the risk of non-payment from their borrowers in emerging markets. This product represents more than 50% of our enforced portfolio of traditional political risk, sovereign default insurance and emerging market credit insurance. For the credit insurance contracts it is necessary for the buyer of the insurance, most often a bank, to hold an insured asset, most often an underlying loan, in order to claim compensation under the insurance contract.The vast majority of the credit insurance provided is for single name illiquid risks primarily in the form of senior and secured bank loans that can be individually analyzed and underwritten. As part of this underwriting process our rigorous evaluation of the credit worthiness and reputation of the obligor is critical and forms the cornerstone of the underwriting process, in addition, of course, for the viability of the use of the loan.We insist that our clients retain a significant share of each transaction that we insure. A key driver of the underwriting analysis is the assessment of recovery in the event of default. So, the strength of the collateral and the enforceability of rights to the collateral are paramount. Again, I will want to emphasize that our products are insurance products. Our contracts normally contain warranties, representations, exclusions, and waiting periods.We strictly avoid insurance for structured finance products defined by pools of risk and insurance for synthetic products that would expose us to mark to market losses. Our portfolio is subject to the usual concentration and aggregation limits. Our senior management regularly reviews credit related insured exposures at an aggregate level as well as by country, region, industry segment, and counterparty. Analysis by region allows to address and understand our potential exposure to cross border contusion which is generally seen as the cat scenario in this line of business.As a general comment, our experience in 2008 has been within our expectations for traditional political risk, sovereign default insurance and credit insurance. I will now share with you some additional information about our experience in 2008. The notices received in 2008 number eight in all. Seven notices of default and one political risk notice. Of these, only three are expected to result in net losses to AXIS and we are fully reserved for these expected net losses. To give you an indication of our net exposure from these three losses the average net case reserve for these three is $9.5 million. These net case reserves reflect conservative estimates of recovery and if there are higher recoveries the ultimate net losses could be lower.The other notices for which we do not expect a net loss reflect the strength of our underwriting principals. They were either entirely result due to receipt of collateral or restructuring or are well on their way to being resolved.Whilst we are obviously at heightened risk because of the global financial crisis our portfolio continues to perform well and within expectations but could deteriorate if the global economy experiences a further substantial decline. Our current levels of general IB&R for political risk, sovereign default insurance and credit insurance portfolio make up approximately 75% of total reserves for these lines.Now I will move on to a brief discussion of our experience at the first of January renewals and our reinsurance segment and the market conditions facing both our insurance and reinsurance businesses. Starting with reinsurance, with the exception of the most capital intensive reinsurance lines like property cat there was a tendency globally to renew programs with good underwriting experience that expiring structures with little to marginal change in terms and conditions.In most renewals expiring markets maintain market share with some exceptions involving concerns over the financial strength of certain reinsurers. We expect this trend to continue in 2009 and we expect to continue to strategically benefit from it. For the first of January renewal we estimate our AXIS re-underwriting near premiums were up 11% over the expiring amounts. Overall, we were up 16% in terms of currency adjusted premium with margins up on balance year over year.We expect some other activity in the quarter that will impact top line for this segment. The first of January gives a good indication of our competitive positioning. Driving the growth for us were our credit and bond reinsurance business in continental Europe and our US professional liability and general casualty reinsurance business. We were able to gain strategic share on attractive treaties due to concerns over the financial strength of distress reinsurers particularly for US casualty reinsurance business.The credit and bond reinsurance market in continental Europe experienced significant dislocation at renewal and we were able to consolidate our position at pricing and terms we believe to be fair and advantageous give the market conditions. These sedans have a proven track record of being able to detach from the economic environment and as you have seen from global press reports they have been executing on all of the top measures to mitigate loss potential in a deteriorating economic environment.We believe that their globalization and increasing technological sophistication positions their portfolios with an acceptable loss parameters. They have substantially increased their retentions over the last several years which strongly support financial alignment with reinsurers. We believe that were in a particularly good position to address the dislocation as we had a relatively small book going into renewal as opposed to the leading market difference and importantly we were not heavily exposed to geographic areas like Spain which have been hit the hardest by losses.Outside of the US, European and Caribbean property cat placements were up approximately 5% but all other non-US geographies were down. The US property cat market however showed strong increases that gained significant momentum as the renewal season wore on. Small regional covers with low loss experience renew flat to modestly up. Larger regional and super regional placements saw increases closer to 10% and more if loss effective.Nationwide placements or placements with heavier southeast exposures were up 15% to 20% and even more in some cases. We believe several of these major placements were not fully subscribed. The number of shortfall covers and private placements that seem to have bound in the market was a very good indication of relative market discipline and a lack of new capacity. We firmly believe that rates will continue to strengthen in peak zones as we head into the spring.Since the first of January we have seen upward movement on US earthquake driven property cat treaties. This is an encouraging sign that the upward bias in price is not limited to the wind peril. Continued dislocations in the Florida market are likely to add even more upward pressure on pricing for Florida exposed risk.Overall, AXIS property cat reinsurance premium was relatively stable as at the first of January. However, weve reduced our exposure to European windstorm due to the less attractive risk reward profile relative to other peak zones and to a lesser extent the movement in exchange rates. More broadly we are also attaching higher in a number of programs.For our insurance segment the first quarter is less significant in terms of production. However, Id like to share a few observations with you. The market continues to soften in a number of classes, although the rate at which this occurs has slowed considerably. Terms and conditions as well as breadth of coverage generally remain stable with terms of trade holding firm. We continue to see some markets fight for market share with the most aggressive behavior in our view coming from distressed insurers.Some new markets or markets that have increased our appetite for certain lines of business are also exhibiting aggressive behavior. Clients are focusing intensely on insurer financial strength and weve been able to address this proactively. Cat exposed property lines are seeing more positive change. We started to see the quantum of rate reductions in property reduced through October and November then stabilized through December and now we are beginning to see growing pressure for rate increases. We expect this momentum increase as we head into the key March 1 st and April 1 st property renewals. A number of key competitors appear to be reducing critical cat exposure which will add further positive impact on the market.Offshore energy is also hardening due to the impact of hurricane Ike. Non-Gulf of Mexico exposure is seeing price increases in the range of 15% to 20%. There have not yet been any Gulf of Mexico renewals of note but we are fully expecting significant improvement there. We intend to capitalize on this change with the same laser focus discipline and risk management that delivered our performance for our off shore energy portfolio in hurricane Ike.In D&O the environment remains competitive; however, we are seeing a fair share of opportunities due to dislocation of business formerly place with certain distressed insurers. In a number of instances we are asked to move down layers to replace questionable security. We are uniquely qualified and positioned to take advantage of these opportunities. In the financial institutions class rates in the fourth quarter continued to increase and we expect this to continue throughout 2009. The bulk of rate increases are in the D&O and E&O lines.The ancillary lines such as employers practice liability, pension and crime, remain stable. Capacity has been reduced by all insurers of these lines making it difficult for brokers to fill larger programs. Our ability to become more relevant in the D&O and E&O lines affords us increased opportunity to further balance our portfolio with preferred ancillary lines such as financial fidelity.AXIS is perceived as a leader that is defined by consistency, financial strength and high service capability. This, coupled with the significant dislocation in the marketplace has resulted in a dramatic change in our competitive position in professional lines.In the casualty lines after brief stabilization in the marketplace in October and November we have seen aggressive competition return driven by distressed insurers. We have not pursued writing new business in these lines for some time unless it has been particularly compelling. We fully expect this competition to abate gradually as the impact of rising reinsurance costs take effect and as clients move business away from distressed insurers.In conclusion, despite the enormity of the challenges of 2008 and those that we face in 2009 I am happy that inherent strength of AXIS has been confirmed and its relative position in the market thus substantially improved. I believe our company will benefit strongly from positive differentiation in these demanding times. This will help us to deliver the return our shareholders expect over time.Now I would like to open the lines for questions.Question-and-Answer Session"

tst3 = "Our ability to become more relevant in the D&O and E&O lines affords us increased opportunity to further balance our portfolio with preferred ancillary lines such as financial fidelity.AXIS is perceived as a leader that is defined by consistency, financial strength and high service capability. This, coupled with the significant dislocation in the marketplace has resulted in a dramatic change in our competitive position in professional lines.In the casualty lines after brief stabilization in the marketplace in October and November we have seen aggressive competition return driven by distressed insurers. We have not pursued writing new business in these lines for some time unless it has been particularly compelling. We fully expect this competition to abate gradually as the impact of rising reinsurance costs take effect and as clients move business away from distressed insurers.In conclusion, despite the enormity of the challenges of 2008 and those that we face in 2009 I am happy that inherent strength of AXIS has been confirmed and its relative position in the market thus substantially improved. I believe our company will benefit strongly from positive differentiation in these demanding times. This will help us to deliver the return our shareholders expect over time"

# Creates JSON serializer instance
serializer = semantria.JsonSerializer()

# Gets subscription information

# Initializes new session with the serializer object and the keys.
consumerKey = "06844c44-0e08-46ea-9db0-9f16657e70ec"
consumerSecret = "a01471c1-c999-4990-8746-f28fbe778b24"
session = semantria.Session(consumerKey, consumerSecret, serializer, use_compression=True)
subscription = session.getSubscription()
print('batch lim :' , subscription['basic_settings']['incoming_batch_limit'])
print(' past h')
documents = []
obs = 0
for sents in tst2.split('.'):
    obs = obs + 1
    sents = sents + '.'
    if obs< 100:
       documents.append({'id': str(obs), 'text': sents})
print(len(documents))

documents = []
documents.append({'id': '3', 'text': tst3})
documents.append({'id': '3', 'text': tst3})
print(len(documents))


status = session.queueBatch(documents)
response = session.getProcessedDocuments()

output = open('resps_tmp.pkl', 'wb')
#pickle.dump(response, output)
dill.dump_session('dumpsess2.pk1')
output.close()
